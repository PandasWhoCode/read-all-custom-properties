name: 'Read Custom Properties of All Repos in Organization'
description: 'Read all the custom properties and values of all repos in an organization'
author: 'Andrew Brandt <andrew.brandt@hashgraph.com>'
organization: 'PandasWhoCode'
branding:
  icon: 'check-circle'
  color: 'black'

inputs:
  token:
    description: 'Personal Access Token'
    required: true

runs:
  using: "composite"
  steps:

    - name: Install yq (mikefarah's version)
      shell: bash
      run: |
        sudo wget --quiet https://github.com/mikefarah/yq/releases/latest/download/yq_linux_amd64 -O /usr/bin/yq
        sudo chmod +x /usr/bin/yq
        yq --version  # confirm installed
    
    

    - name: List all repos in org
      shell: bash
      env:
        GH_TOKEN: ${{ inputs.token }}
      run: |
        ORG_NAME=$(echo "$GITHUB_REPOSITORY" | cut -d'/' -f1)
        echo "Org name is: ${ORG_NAME}"
        echo "${ORG_NAME}" > org-name.txt
        echo "Fetching repos for organization: ${{ inputs.org }}"
        gh api --paginate "orgs/$ORG_NAME/repos" --jq '.[].full_name' > repo-list.txt
        echo "Repos written to repo-list.txt"

    - name: Print out all repos in file
      shell: bash
      run: |
        echo "Org name is:"
        cat org-name.txt
        echo "Full list of repos in org:"
        cat repo-list.txt
